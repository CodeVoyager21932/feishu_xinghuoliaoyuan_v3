<!--components/daily-sign-modal/daily-sign-modal.wxml-->
<view class="modal-container" wx:if="{{visible}}">
  <!-- é®ç½©å±‚ -->
  <view class="modal-mask" bindtap="onClose"></view>
  
  <!-- å†…å®¹åŒº -->
  <view class="modal-content">
    <!-- å…³é—­æŒ‰é’® -->
    <view class="close-btn" bindtap="onClose">
      <text class="icon-close">âœ•</text>
    </view>

    <!-- æµ·æŠ¥é¢„è§ˆåŒº -->
    <view class="poster-preview">
      <!-- éšè—çš„Canvasï¼Œç”¨äºç¦»å±æ¸²æŸ“ -->
      <canvas 
        type="2d" 
        id="posterCanvas" 
        class="poster-canvas"
        style="width: {{canvasWidth}}px; height: {{canvasHeight}}px;"
      ></canvas>
      
      <!-- é¢„è§ˆå›¾ï¼ˆWXMLå¸ƒå±€ï¼Œä¼˜å…ˆæ˜¾ç¤ºï¼‰ -->
      <view class="preview-layout" wx:if="{{showPreview && !posterPath}}">
        <image 
          class="preview-bg" 
          src="{{todayQuote.image_url || '/images/default-bg.jpg'}}" 
          mode="aspectFill"
        />
        <view class="preview-mask"></view>
        
        <!-- æ—¥æœŸå°ç«  -->
        <view class="preview-stamp">
          <text class="stamp-month">{{currentMonth}}æœˆ</text>
          <text class="stamp-day">{{currentDay}}</text>
        </view>
        
        <!-- è¯—è¯å†…å®¹ -->
        <view class="preview-quote">
          <text class="quote-text">{{todayQuote.quote_content}}</text>
          <text class="quote-author" wx:if="{{todayQuote.author}}">â€” {{todayQuote.author}}</text>
        </view>
        
        <!-- ç”Ÿæˆä¸­æç¤º -->
        <view class="generating-hint" wx:if="{{isGenerating}}">
          <view class="hint-dot"></view>
          <text>æµ·æŠ¥ç”Ÿæˆä¸­...</text>
        </view>
      </view>
      
      <!-- ç”Ÿæˆåæ˜¾ç¤ºçš„çœŸå®æµ·æŠ¥ -->
      <image 
        wx:if="{{posterPath}}" 
        src="{{posterPath}}" 
        class="poster-image"
        mode="aspectFit"
      ></image>
    </view>

    <!-- ä»Šæ—¥å®œå¿Œ -->
    <view class="lucky-tips" wx:if="{{todayQuote.lucky_tips}}">
      <text class="tips-label">ä»Šæ—¥å®œï¼š</text>
      <text class="tips-content">{{todayQuote.lucky_tips}}</text>
    </view>

    <!-- æ“ä½œæŒ‰é’® -->
    <view class="action-buttons">
      <button 
        class="btn-primary {{isGenerating ? 'disabled' : ''}}" 
        bindtap="onSaveToAlbum"
        disabled="{{isGenerating}}"
      >
        <text class="btn-icon">ğŸ’¾</text>
        <text>ä¿å­˜åˆ°ç›¸å†Œ</text>
      </button>
      
      <button 
        class="btn-secondary {{isGenerating ? 'disabled' : ''}}" 
        bindtap="onShareToFriend"
        disabled="{{isGenerating}}"
      >
        <text class="btn-icon">ğŸ“¤</text>
        <text>åˆ†äº«ç»™å¥½å‹</text>
      </button>
    </view>
  </view>
</view>
