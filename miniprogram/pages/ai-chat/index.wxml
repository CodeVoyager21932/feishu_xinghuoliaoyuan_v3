<!-- AI对话页面 -->
<navigation-bar title="AI讲解员" showBack="{{true}}" showHome="{{true}}" background="transparent"></navigation-bar>
<view class="chat-page">
  <!-- 顶部背景装饰 -->
  <view class="bg-decoration"></view>

  <!-- 顶部导航 (Glassmorphism Header) -->
  <view class="chat-header-glass animate-fade-in">
    <view class="header-content">
      <view class="ai-info">
        <view class="avatar-ring">
          <image class="ai-avatar" src="{{aiAvatar}}" mode="aspectFill" />
        </view>
        <view class="header-text">
          <text class="ai-name font-serif">{{aiName}}</text>
          <view class="status-badge">
            <view class="status-dot"></view>
            <text class="ai-desc">{{aiDesc}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>
  
  <!-- 消息列表 -->
  <scroll-view 
    class="message-list" 
    scroll-y 
    scroll-into-view="{{scrollToId}}"
    scroll-with-animation
    enable-flex
  >
    <view class="message-padding">
      <view class="message-welcome animate-fade-in">
        <text>你好！我是星火同志，一位深耕中共党史五十年的资深研究员。有什么关于红色历史的问题，尽管问我吧！</text>
      </view>
      
      <block wx:for="{{messages}}" wx:key="index">
        <view class="message-item {{item.role}} animate-slide-up" id="msg-{{index}}">
          <image 
            class="avatar" 
            src="{{item.role === 'user' ? userAvatar : aiAvatar}}" 
            mode="aspectFill"
          />
          <view class="bubble-wrapper">
            <view class="bubble {{item.role}}">
              <text class="content" user-select>{{item.content}}</text>
            </view>
            <text class="time">{{item.time}}</text>
          </view>
        </view>
      </block>
      
      <!-- 加载中提示 -->
      <view class="loading-wrapper" wx:if="{{isLoading}}">
        <view class="loading-content">
          <view class="loading-bubble">
            <view class="dot"></view>
            <view class="dot"></view>
            <view class="dot"></view>
          </view>
          <view class="loading-tip animate-fade-in">
            <text>{{currentTip}}</text>
          </view>
        </view>
      </view>
      
      <!-- 底部占位，防止被输入框遮挡 -->
      <view style="height: 120rpx;"></view>
    </view>
  </scroll-view>
  
  <!-- 输入框 (Floating Input Bar) -->
  <view class="input-container">
    <view class="input-glass">
      <input 
        class="input" 
        placeholder="向{{aiName}}提问..." 
        placeholder-class="input-placeholder"
        value="{{inputText}}"
        bindinput="onInput"
        confirm-type="send"
        bindconfirm="onSend"
        adjust-position="{{false}}"
      />
      <button 
        class="send-btn {{inputText ? 'active' : ''}}" 
        bindtap="onSend"
        disabled="{{isLoading || !inputText}}"
      >
        <text class="icon-send">↑</text>
      </button>
    </view>
  </view>
</view>


