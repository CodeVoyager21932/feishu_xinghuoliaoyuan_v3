<!--index.wxml-->
<navigation-bar title="æ˜Ÿç«" background="transparent" showBack="{{false}}"></navigation-bar>
<view class="home-page">
  <!-- é¡¶éƒ¨èƒŒæ™¯è£…é¥° (Curtain Effect) -->
  <view class="header-curtain"></view>

  <!-- é¡¶éƒ¨ç”¨æˆ·ä¿¡æ¯ (Glassmorphism) -->
  <view class="header animate-fade-in">
    <view class="user-info-glass">
      <image class="avatar" src="{{userInfo.avatarUrl || '/images/default-avatar.png'}}" />
      <view class="user-text">
        <text class="greeting">{{greeting}}</text>
        <text class="nickname">{{userInfo.nickName || 'æœªç™»å½•'}}</text>
      </view>
    </view>
  </view>



  <!-- åŠŸèƒ½å…¥å£ (Floating Grid) -->
  <view class="function-grid animate-fade-in" style="animation-delay: 0.3s;">
    <view class="grid-item card-hover" bindtap="goToAIChat">
      <view class="icon-wrapper gradient-red">
        <image class="menu-icon" src="/images/icons/ai_chat.png" mode="aspectFit" />
      </view>
      <text class="grid-label">å…ˆè¾ˆå›å“</text>
      <text class="grid-desc">è·¨æ—¶ç©ºå¯¹è¯</text>
    </view>
    <view class="grid-item card-hover" bindtap="goToGraph">
      <view class="icon-wrapper gradient-blue">
        <image class="menu-icon" src="/images/icons/knowledge_graph.png" mode="aspectFit" />
      </view>
      <text class="grid-label">æ˜Ÿç«ç‡åŸ</text>
      <text class="grid-desc">å†å²æ¼”è®²è„‰ç»œ</text>
    </view>
    <view class="grid-item card-hover" bindtap="goToCards">
      <view class="icon-wrapper gradient-gold">
        <image class="menu-icon" src="/images/icons/flashcards.png" mode="aspectFit" />
      </view>
      <text class="grid-label">æ‹¾å…‰ç¢ç‰‡</text>
      <text class="grid-desc">æ¯æ—¥å…šå²å¾®è¯¾</text>
    </view>

    <view class="grid-item card-hover" bindtap="goToMysteryBox">
      <view class="icon-wrapper gradient-orange">
        <image class="menu-icon" src="/images/icons/mystery_box.png" mode="aspectFit" />
      </view>
      <text class="grid-label">å°˜å°æ¡£æ¡ˆ</text>
      <text class="grid-desc">è§£å¯†å†å²ä¿¡ç‰©</text>
    </view>
    <view class="grid-item card-hover" bindtap="goToMuseum">
      <view class="icon-wrapper gradient-cyan">
        <image class="menu-icon" src="/images/icons/museum.png" mode="aspectFit" />
      </view>
      <text class="grid-label">åˆå¿ƒå°è®°</text>
      <text class="grid-desc">æˆ‘çš„æ”¶è—/æˆå°±</text>
    </view>
    <view class="grid-item card-hover" bindtap="goToPKBattle">
      <view class="icon-wrapper gradient-pink">
        <image class="menu-icon" src="/images/icons/pk_battle.png" mode="aspectFit" />
      </view>
      <text class="grid-label">ä¸Šä¸‹æ±‚ç´¢</text>
      <text class="grid-desc">æµ¸æµ¸å¾é€”</text>
    </view>
    <view class="grid-item card-hover" bindtap="goToRadio">
      <view class="icon-wrapper gradient-brown">
        <image class="menu-icon" src="/images/icons/radio.png" mode="aspectFit" />
      </view>
      <text class="grid-label">æ°¸ä¸æ¶ˆé€</text>
      <text class="grid-desc">è·¨æ—¶ç©ºç”µæ³¢</text>
    </view>
  </view>

  <!-- å…¨å±€éŸ³é¢‘æ’­æ”¾å™¨ -->
  <audio-player></audio-player>

  <!-- å­¦ä¹ ç»Ÿè®¡ (Dashboard Widget) -->
  <view class="stats-section animate-fade-in" style="animation-delay: 0.4s;">
    <view class="stats-card card-hover">
      <view class="stats-header">
        <text class="font-serif title-medium">å­¦ä¹ æˆå°±</text>
        <view class="level-badge" bindtap="showBadgeDetail">Lv.{{userLevel || 1}} æ˜Ÿç«ç‡åŸ</view>
      </view>
      <view class="stats-row">
        <view class="stat-item">
          <text class="stat-num">{{stats.continuous_days}}<text class="stat-unit">å¤©</text></text>
          <text class="stat-label">è¿ç»­æ‰“å¡</text>
        </view>
        <view class="stat-divider"></view>
        <view class="stat-item">
          <text class="stat-num">{{stats.mastered_cards}}<text class="stat-unit">å¼ </text></text>
          <text class="stat-label">æŒæ¡å¡ç‰‡</text>
        </view>
        <view class="stat-divider"></view>
        <view class="stat-item">
          <text class="stat-num">{{stats.ai_chat_count}}<text class="stat-unit">æ¬¡</text></text>
          <text class="stat-label">AIäº’åŠ¨</text>
        </view>
      </view>
    </view>
  </view>

  <!-- Floating Action Button (FAB) for Daily Sign -->
  <view class="fab-daily-sign animate-fade-in" bindtap="onOpenDailySign">
    <text class="fab-icon">ğŸ“…</text>
    <text class="fab-text">æ—¥ç­¾</text>
  </view>
</view>

<!-- æ—¥ç­¾å¼¹çª— -->
<!-- æ—¥ç­¾å¼¹çª— (æ—¶ç©ºæ¥ä¿¡) -->
<daily-letter 
  visible="{{showDailySign}}" 
  content="{{todayQuote.content}}"
  quote="{{todayQuote.quote}}"
  author="{{todayQuote.author}}"
  bind:close="onCloseDailySign"
  bind:checkin="onDailyCheckIn"
></daily-letter>

<!-- å¾½ç« è¯¦æƒ…å¼¹çª— -->
<badge-modal
  visible="{{showBadgeModal}}"
  badge="{{currentBadge}}"
  bind:close="onCloseBadgeModal"
></badge-modal>
