<!--index.wxml-->
<navigation-bar title="星火" background="transparent" showBack="{{false}}"></navigation-bar>
<view class="home-page">
  <!-- 顶部背景装饰 (Curtain Effect) -->
  <view class="header-curtain"></view>

  <!-- 顶部用户信息 (Glassmorphism) -->
  <view class="header animate-fade-in">
    <view class="user-info-glass">
      <image class="avatar" src="{{userInfo.avatarUrl || '/images/default-avatar.png'}}" />
      <view class="user-text">
        <text class="greeting">{{greeting}}</text>
        <text class="nickname">{{userInfo.nickName || '未登录'}}</text>
      </view>
    </view>
  </view>



  <!-- 功能入口 (Floating Grid) -->
  <view class="function-grid animate-fade-in" style="animation-delay: 0.3s;">
    <view class="grid-item card-hover" bindtap="goToAIChat">
      <view class="icon-wrapper gradient-red">
        <image class="menu-icon" src="/images/icons/ai_chat.png" mode="aspectFit" />
      </view>
      <text class="grid-label">先辈回响</text>
      <text class="grid-desc">跨时空对话</text>
    </view>
    <view class="grid-item card-hover" bindtap="goToGraph">
      <view class="icon-wrapper gradient-blue">
        <image class="menu-icon" src="/images/icons/knowledge_graph.png" mode="aspectFit" />
      </view>
      <text class="grid-label">星火燎原</text>
      <text class="grid-desc">历史演讲脉络</text>
    </view>
    <view class="grid-item card-hover" bindtap="goToCards">
      <view class="icon-wrapper gradient-gold">
        <image class="menu-icon" src="/images/icons/flashcards.png" mode="aspectFit" />
      </view>
      <text class="grid-label">拾光碎片</text>
      <text class="grid-desc">每日党史微课</text>
    </view>

    <view class="grid-item card-hover" bindtap="goToMysteryBox">
      <view class="icon-wrapper gradient-orange">
        <image class="menu-icon" src="/images/icons/mystery_box.png" mode="aspectFit" />
      </view>
      <text class="grid-label">尘封档案</text>
      <text class="grid-desc">解密历史信物</text>
    </view>
    <view class="grid-item card-hover" bindtap="goToMuseum">
      <view class="icon-wrapper gradient-cyan">
        <image class="menu-icon" src="/images/icons/museum.png" mode="aspectFit" />
      </view>
      <text class="grid-label">初心印记</text>
      <text class="grid-desc">我的收藏/成就</text>
    </view>
    <view class="grid-item card-hover" bindtap="goToPKBattle">
      <view class="icon-wrapper gradient-pink">
        <image class="menu-icon" src="/images/icons/pk_battle.png" mode="aspectFit" />
      </view>
      <text class="grid-label">上下求索</text>
      <text class="grid-desc">浸浸征途</text>
    </view>
    <view class="grid-item card-hover" bindtap="goToHeroes">
      <view class="icon-wrapper gradient-purple">
        <image class="menu-icon" src="/images/icons/heroes.png" mode="aspectFit" />
      </view>
      <text class="grid-label">民族脊梁</text>
      <text class="grid-desc">英雄人物传</text>
    </view>
    <view class="grid-item card-hover" bindtap="goToRadio">
      <view class="icon-wrapper gradient-brown">
        <image class="menu-icon" src="/images/icons/radio.png" mode="aspectFit" />
      </view>
      <text class="grid-label">永不消逝</text>
      <text class="grid-desc">跨时空电波</text>
    </view>
  </view>

  <!-- 全局音频播放器 -->
  <audio-player></audio-player>

  <!-- 学习统计 (Dashboard Widget) -->
  <view class="stats-section animate-fade-in" style="animation-delay: 0.4s;">
    <view class="stats-card card-hover">
      <view class="stats-header">
        <text class="font-serif title-medium">学习成就</text>
        <view class="level-badge" bindtap="showBadgeDetail">Lv.{{userLevel || 1}} 星火燎原</view>
      </view>
      <view class="stats-row">
        <view class="stat-item">
          <text class="stat-num">{{stats.continuous_days}}<text class="stat-unit">天</text></text>
          <text class="stat-label">连续打卡</text>
        </view>
        <view class="stat-divider"></view>
        <view class="stat-item">
          <text class="stat-num">{{stats.mastered_cards}}<text class="stat-unit">张</text></text>
          <text class="stat-label">掌握卡片</text>
        </view>
        <view class="stat-divider"></view>
        <view class="stat-item">
          <text class="stat-num">{{stats.ai_chat_count}}<text class="stat-unit">次</text></text>
          <text class="stat-label">AI互动</text>
        </view>
      </view>
    </view>
  </view>

  <!-- Floating Action Button (FAB) for Daily Sign -->
  <view class="fab-daily-sign animate-fade-in" bindtap="onOpenDailySign">
    <text class="fab-icon">📅</text>
    <text class="fab-text">日签</text>
  </view>
</view>

<!-- 日签弹窗 -->
<!-- 日签弹窗 (时空来信) -->
<daily-letter 
  visible="{{showDailySign}}" 
  content="{{todayQuote.content}}"
  quote="{{todayQuote.quote}}"
  author="{{todayQuote.author}}"
  bind:close="onCloseDailySign"
  bind:checkin="onDailyCheckIn"
></daily-letter>

<!-- 徽章详情弹窗 -->
<badge-modal
  visible="{{showBadgeModal}}"
  badge="{{currentBadge}}"
  bind:close="onCloseBadgeModal"
></badge-modal>
