<!--index.wxml-->
<navigation-bar title="æ˜Ÿç«" background="transparent" showBack="{{false}}"></navigation-bar>
<view class="home-page">
  <!-- é¡¶éƒ¨èƒŒæ™¯è£…é¥° -->
  <view class="bg-decoration"></view>

  <!-- é¡¶éƒ¨ç”¨æˆ·ä¿¡æ¯ (Glassmorphism) -->
  <view class="header animate-fade-in">
    <view class="user-info-glass">
      <image class="avatar" src="{{userInfo.avatarUrl || '/images/default-avatar.png'}}" />
      <view class="user-text">
        <text class="greeting">{{greeting}}</text>
        <text class="nickname">{{userInfo.nickName || 'æœªç™»å½•'}}</text>
      </view>
      <!-- ç‹¬ç«‹çš„æ—¥ç­¾èƒ¶å›Š -->
      <view class="daily-sign-capsule" bindtap="onOpenDailySign">
        <text class="icon-calendar">ğŸ“…</text>
        <text>æ—¥ç­¾</text>
      </view>
    </view>
  </view>

  <!-- ä»Šæ—¥è‹±é›„å¡ç‰‡ (Premium Card) -->
  <view class="section-title animate-fade-in" style="animation-delay: 0.1s;">
    <text class="font-serif">ä»Šæ—¥è‹±é›„</text>
    <text class="date-badge">{{todayDate}}</text>
  </view>
  
  <wxs module="gesture" src="./card-gesture.wxs"></wxs>

  <view class="today-hero-card card-hover animate-fade-in" 
        style="animation-delay: 0.2s;" 
        bindtap="goToHeroDetail"
        bindtouchstart="{{gesture.touchStart}}"
        bindtouchmove="{{gesture.touchMove}}"
        bindtouchend="{{gesture.touchEnd}}"
        bindtouchcancel="{{gesture.touchEnd}}"
  >
    <view class="card-glare" style="{{heroCardGlare}}"></view>
    <view class="hero-bg-gradient"></view>
    <view class="hero-content">
      <view class="hero-badge">
        <text>â­ æ¯æ—¥æ¨è</text>
      </view>
      <view class="hero-main">
        <view class="hero-avatar-wrapper">
          <image 
            class="hero-avatar" 
            src="{{todayHero.avatar}}" 
            mode="aspectFill"
            binderror="onImageError"
          />
          <view class="hero-placeholder" wx:if="{{!todayHero.avatarLoaded}}">
            <text class="placeholder-text">{{todayHero.name[0]}}</text>
          </view>
        </view>
        <view class="hero-text-group">
          <text class="hero-name font-serif">{{todayHero.name}}</text>
          <text class="hero-title">{{todayHero.title || 'é©å‘½è‹±é›„'}}</text>
          <text class="hero-desc">{{todayHero.brief}}</text>
        </view>
      </view>
      <view class="hero-footer">
        <text class="tap-hint">ç‚¹å‡»æŸ¥çœ‹ç”Ÿå¹³ ></text>
      </view>
    </view>
  </view>

  <!-- åŠŸèƒ½å…¥å£ (Floating Grid) -->
  <view class="function-grid animate-fade-in" style="animation-delay: 0.3s;">
    <view class="grid-item card-hover" bindtap="goToAIChat">
      <view class="icon-wrapper gradient-red">
        <view class="icon-placeholder"></view>
      </view>
      <text class="grid-label">AIè®²è§£å‘˜</text>
      <text class="grid-desc">è·¨æ—¶ç©ºå¯¹è¯</text>
    </view>
    <view class="grid-item card-hover" bindtap="goToGraph">
      <view class="icon-wrapper gradient-blue">
        <view class="icon-placeholder"></view>
      </view>
      <text class="grid-label">çŸ¥è¯†å›¾è°±</text>
      <text class="grid-desc">å†å²è„‰ç»œ</text>
    </view>
    <view class="grid-item card-hover" bindtap="goToCards">
      <view class="icon-wrapper gradient-gold">
        <view class="icon-placeholder"></view>
      </view>
      <text class="grid-label">å¡ç‰‡å­¦ä¹ </text>
      <text class="grid-desc">è®°å¿†ç¢ç‰‡</text>
    </view>
    <view class="grid-item card-hover" bindtap="goToHeroes">
      <view class="icon-wrapper gradient-purple">
        <view class="icon-placeholder"></view>
      </view>
      <text class="grid-label">è‹±é›„é•¿å»Š</text>
      <text class="grid-desc">ç¾¤è‹±èŸèƒ</text>
    </view>
    <view class="grid-item card-hover" bindtap="goToMysteryBox">
      <view class="icon-wrapper gradient-orange">
        <view class="icon-placeholder"></view>
      </view>
      <text class="grid-label">æœºå¯†æ¡£æ¡ˆ</text>
      <text class="grid-desc">ä¿¡ç‰©æ”¶é›†</text>
    </view>
    <view class="grid-item card-hover" bindtap="goToMuseum">
      <view class="icon-wrapper gradient-cyan">
        <view class="icon-placeholder"></view>
      </view>
      <text class="grid-label">çè—é¦†</text>
      <text class="grid-desc">æˆ‘çš„æ”¶è—</text>
    </view>
    <view class="grid-item card-hover" bindtap="goToPKBattle">
      <view class="icon-wrapper gradient-pink">
        <view class="icon-placeholder"></view>
      </view>
      <text class="grid-label">PKå¯¹æˆ˜</text>
      <text class="grid-desc">ç­”é¢˜æŒ‘æˆ˜</text>
    </view>
    <view class="grid-item card-hover" bindtap="goToRadio">
      <view class="icon-wrapper gradient-brown">
        <view class="icon-placeholder"></view>
      </view>
      <text class="grid-label">çº¢è‰²ç”µå°</text>
      <text class="grid-desc">å…šå²æ•…äº‹</text>
    </view>
  </view>

  <!-- å…¨å±€éŸ³é¢‘æ’­æ”¾å™¨ -->
  <audio-player></audio-player>

  <!-- å­¦ä¹ ç»Ÿè®¡ (Dashboard Widget) -->
  <view class="stats-section animate-fade-in" style="animation-delay: 0.4s;">
    <view class="stats-card card-hover">
      <view class="stats-header">
        <text class="font-serif title-medium">å­¦ä¹ æˆå°±</text>
        <view class="level-badge" bindtap="showBadgeDetail">Lv.{{userLevel || 1}} æ˜Ÿç«ç‡åŸ</view>
      </view>
      <view class="stats-row">
        <view class="stat-item">
          <text class="stat-num">{{stats.continuous_days}}<text class="stat-unit">å¤©</text></text>
          <text class="stat-label">è¿ç»­æ‰“å¡</text>
        </view>
        <view class="stat-divider"></view>
        <view class="stat-item">
          <text class="stat-num">{{stats.mastered_cards}}<text class="stat-unit">å¼ </text></text>
          <text class="stat-label">æŒæ¡å¡ç‰‡</text>
        </view>
        <view class="stat-divider"></view>
        <view class="stat-item">
          <text class="stat-num">{{stats.ai_chat_count}}<text class="stat-unit">æ¬¡</text></text>
          <text class="stat-label">AIäº’åŠ¨</text>
        </view>
      </view>
    </view>
  </view>
</view>

<!-- æ—¥ç­¾å¼¹çª— -->
<!-- æ—¥ç­¾å¼¹çª— (æ—¶ç©ºæ¥ä¿¡) -->
<daily-letter 
  visible="{{showDailySign}}" 
  content="{{todayQuote.content}}"
  quote="{{todayQuote.quote}}"
  author="{{todayQuote.author}}"
  bind:close="onCloseDailySign"
  bind:checkin="onDailyCheckIn"
></daily-letter>

<!-- å¾½ç« è¯¦æƒ…å¼¹çª— -->
<badge-modal
  visible="{{showBadgeModal}}"
  badge="{{currentBadge}}"
  bind:close="onCloseBadgeModal"
></badge-modal>
