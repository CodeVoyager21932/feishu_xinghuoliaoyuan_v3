<!--index.wxml-->
<navigation-bar title="æ˜Ÿç«" backgroundClass="transparent" fixed="{{true}}"></navigation-bar>
<view class="home-page">
  <!-- é¡¶éƒ¨èƒŒæ™¯è£…é¥° -->
  <view class="bg-decoration"></view>

  <!-- é¡¶éƒ¨ç”¨æˆ·ä¿¡æ¯ (Glassmorphism) -->
  <view class="header animate-fade-in">
    <view class="user-info-glass">
      <image class="avatar" src="{{userInfo.avatarUrl || '/images/default-avatar.png'}}" />
      <view class="user-text">
        <text class="greeting">æ—©å®‰ï¼ŒåŒå¿—</text>
        <text class="nickname">{{userInfo.nickName || 'æœªç™»å½•'}}</text>
      </view>
      <button class="daily-sign-btn" bindtap="onOpenDailySign">
        <text class="icon-calendar">ğŸ“…</text>
        <text>æ—¥ç­¾</text>
      </button>
    </view>
  </view>

  <!-- ä»Šæ—¥è‹±é›„å¡ç‰‡ (Premium Card) -->
  <view class="section-title animate-fade-in" style="animation-delay: 0.1s;">
    <text class="font-serif">ä»Šæ—¥è‹±é›„</text>
    <text class="date-badge">{{todayDate}}</text>
  </view>
  
  <view class="today-hero-card card-hover animate-fade-in {{isHeroCardTouching ? 'touching' : ''}}" 
        style="animation-delay: 0.2s; {{heroCardTransform}}" 
        bindtap="goToHeroDetail"
        bindtouchstart="onHeroCardTouchStart"
        bindtouchmove="onHeroCardTouchMove"
        bindtouchend="onHeroCardTouchEnd"
        bindtouchcancel="onHeroCardTouchEnd"
  >
    <view class="card-glare" style="{{heroCardGlare}}"></view>
    <view class="hero-bg-gradient"></view>
    <view class="hero-content">
      <view class="hero-badge">
        <text>â­ æ¯æ—¥æ¨è</text>
      </view>
      <view class="hero-main">
        <view class="hero-avatar-wrapper">
          <image 
            class="hero-avatar" 
            src="{{todayHero.avatar}}" 
            mode="aspectFill"
            binderror="onImageError"
          />
          <view class="hero-placeholder" wx:if="{{!todayHero.avatarLoaded}}">
            <text class="placeholder-text">{{todayHero.name[0]}}</text>
          </view>
        </view>
        <view class="hero-text-group">
          <text class="hero-name font-serif">{{todayHero.name}}</text>
          <text class="hero-title">{{todayHero.title || 'é©å‘½è‹±é›„'}}</text>
          <text class="hero-desc">{{todayHero.brief}}</text>
        </view>
      </view>
      <view class="hero-footer">
        <text class="tap-hint">ç‚¹å‡»æŸ¥çœ‹ç”Ÿå¹³ ></text>
      </view>
    </view>
  </view>

  <!-- åŠŸèƒ½å…¥å£ (Floating Grid) -->
  <view class="function-grid animate-fade-in" style="animation-delay: 0.3s;">
    <view class="grid-item card-hover" bindtap="goToAIChat">
      <view class="icon-wrapper gradient-red">
        <text class="icon-emoji">ğŸ¤–</text>
      </view>
      <text class="grid-label">AIè®²è§£å‘˜</text>
      <text class="grid-desc">è·¨æ—¶ç©ºå¯¹è¯</text>
    </view>
    <view class="grid-item card-hover" bindtap="goToGraph">
      <view class="icon-wrapper gradient-blue">
        <text class="icon-emoji">ğŸ•¸ï¸</text>
      </view>
      <text class="grid-label">çŸ¥è¯†å›¾è°±</text>
      <text class="grid-desc">å†å²è„‰ç»œ</text>
    </view>
    <view class="grid-item card-hover" bindtap="goToCards">
      <view class="icon-wrapper gradient-gold">
        <text class="icon-emoji">ğŸ´</text>
      </view>
      <text class="grid-label">å¡ç‰‡å­¦ä¹ </text>
      <text class="grid-desc">è®°å¿†ç¢ç‰‡</text>
    </view>
    <view class="grid-item card-hover" bindtap="goToHeroes">
      <view class="icon-wrapper gradient-purple">
        <text class="icon-emoji">ğŸ¦¸</text>
      </view>
      <text class="grid-label">è‹±é›„é•¿å»Š</text>
      <text class="grid-desc">ç¾¤è‹±èŸèƒ</text>
    </view>
    <view class="grid-item card-hover" bindtap="goToMysteryBox">
      <view class="icon-wrapper gradient-orange">
        <text class="icon-emoji">ğŸ”“</text>
      </view>
      <text class="grid-label">æœºå¯†æ¡£æ¡ˆ</text>
      <text class="grid-desc">ä¿¡ç‰©æ”¶é›†</text>
    </view>
    <view class="grid-item card-hover" bindtap="goToMuseum">
      <view class="icon-wrapper gradient-cyan">
        <text class="icon-emoji">ğŸ›ï¸</text>
      </view>
      <text class="grid-label">çè—é¦†</text>
      <text class="grid-desc">æˆ‘çš„æ”¶è—</text>
    </view>
  </view>

  <!-- å­¦ä¹ ç»Ÿè®¡ (Dashboard Widget) -->
  <view class="stats-section animate-fade-in" style="animation-delay: 0.4s;">
    <view class="stats-card card-hover">
      <view class="stats-header">
        <text class="font-serif title-medium">å­¦ä¹ æˆå°±</text>
        <view class="level-badge">Lv.{{userLevel || 1}} æ˜Ÿç«ç‡åŸ</view>
      </view>
      <view class="stats-row">
        <view class="stat-item">
          <text class="stat-num">{{stats.continuous_days}}<text class="stat-unit">å¤©</text></text>
          <text class="stat-label">è¿ç»­æ‰“å¡</text>
        </view>
        <view class="stat-divider"></view>
        <view class="stat-item">
          <text class="stat-num">{{stats.mastered_cards}}<text class="stat-unit">å¼ </text></text>
          <text class="stat-label">æŒæ¡å¡ç‰‡</text>
        </view>
        <view class="stat-divider"></view>
        <view class="stat-item">
          <text class="stat-num">{{stats.ai_chat_count}}<text class="stat-unit">æ¬¡</text></text>
          <text class="stat-label">AIäº’åŠ¨</text>
        </view>
      </view>
    </view>
  </view>
</view>

<!-- æ—¥ç­¾å¼¹çª— -->
<daily-sign-modal 
  visible="{{showDailySign}}" 
  todayQuote="{{todayQuote}}"
  bind:close="onCloseDailySign"
  bind:checkin="onDailyCheckIn"
></daily-sign-modal>
