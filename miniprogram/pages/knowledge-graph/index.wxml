<!-- Áü•ËØÜÂõæË∞±È°µÈù¢ -->
<view class="graph-page">
  <!-- ËÉåÊôØË£ÖÈ•∞ -->
  <view class="bg-decoration"></view>

  <!-- È°∂ÈÉ®ÊéßÂà∂Ê†è (Glassmorphism) -->
  <view class="control-bar-glass animate-fade-in">
    <!-- Á≠õÈÄâÂô® -->
    <scroll-view class="filter-scroll" scroll-x enable-flex>
      <view class="filter-list">
        <view 
          class="filter-pill {{filter === 'all' ? 'active' : ''}}"
          bindtap="onFilterChange"
          data-filter="all"
        >
          ÂÖ®ÈÉ®
        </view>
        <view 
          class="filter-pill {{filter === 'revolution' ? 'active' : ''}}"
          bindtap="onFilterChange"
          data-filter="revolution"
        >
          Èù©ÂëΩÊó∂Êúü
        </view>
        <view 
          class="filter-pill {{filter === 'construction' ? 'active' : ''}}"
          bindtap="onFilterChange"
          data-filter="construction"
        >
          Âª∫ËÆæÊó∂Êúü
        </view>
        <view 
          class="filter-pill {{filter === 'reform' ? 'active' : ''}}"
          bindtap="onFilterChange"
          data-filter="reform"
        >
          ÊîπÈù©Êó∂Êúü
        </view>
      </view>
    </scroll-view>

    <!-- ËßÜÂõæÂàáÊç¢ -->
    <view class="view-toggle">
      <view 
        class="toggle-btn {{viewMode === 'timeline' ? 'active' : ''}}"
        bindtap="switchView"
        data-mode="timeline"
      >
        <text class="icon-view">‚â°</text>
      </view>
      <view 
        class="toggle-btn {{viewMode === 'graph' ? 'active' : ''}}"
        bindtap="switchView"
        data-mode="graph"
      >
        <text class="icon-view">üï∏Ô∏è</text>
      </view>
    </view>
  </view>

  <!-- ÂÜÖÂÆπÂå∫Âüü -->
  <view class="content-area">
    <!-- 1. Êó∂Èó¥ËΩ¥ËßÜÂõæ -->
    <scroll-view 
      class="timeline-view animate-fade-in" 
      scroll-y 
      wx:if="{{viewMode === 'timeline'}}"
    >
      <!-- Âä†ËΩΩÁä∂ÊÄÅ -->
      <view class="timeline-container" wx:if="{{isLoading}}">
        <view class="timeline-line"></view>
        <view class="timeline-item" wx:for="{{[1,2,3]}}" wx:key="*this">
          <view class="timeline-dot-wrapper">
            <view class="timeline-dot skeleton"></view>
          </view>
          <view class="timeline-card skeleton-card">
            <view class="skeleton-line short"></view>
            <view class="skeleton-line"></view>
            <view class="skeleton-line long"></view>
          </view>
        </view>
      </view>

      <!-- ÂÜÖÂÆπ -->
      <view class="timeline-container" wx:else>
        <view class="timeline-line"></view>
        
        <!-- Á©∫Áä∂ÊÄÅ -->
        <view class="empty-state" wx:if="{{filteredNodes.length === 0}}">
          <text class="empty-emoji">üîç</text>
          <text class="empty-text">ÊöÇÊó†Áõ∏ÂÖ≥ÂÜÖÂÆπ</text>
        </view>

        <!-- Êó∂Èó¥ËΩ¥ÂàóË°® -->
        <view 
          class="timeline-item animate-slide-up"
          wx:for="{{filteredNodes}}"
          wx:key="id"
          bindtap="onNodeClick"
          data-node="{{item}}"
          style="animation-delay: {{index * 0.05}}s;"
        >
          <view class="timeline-dot-wrapper">
            <view class="timeline-dot {{item.type}}"></view>
          </view>
          <view class="timeline-card card-hover">
            <view class="card-header">
              <text class="node-year">{{item.year}}</text>
              <view class="node-type-badge {{item.type}}">{{item.type === 'event' ? '‰∫ã‰ª∂' : '‰∫∫Áâ©'}}</view>
            </view>
            <text class="node-label font-serif">{{item.label}}</text>
            <text class="node-desc">{{item.description}}</text>
          </view>
        </view>
        
        <!-- Â∫ïÈÉ®ÁïôÁôΩ -->
        <view style="height: 100rpx;"></view>
      </view>
    </scroll-view>

    <!-- 2. Áü•ËØÜÂõæË∞±ËßÜÂõæ (Canvas) -->
    <view 
      class="graph-view animate-fade-in" 
      wx:if="{{viewMode === 'graph'}}"
    >
      <canvas 
        type="2d" 
        id="graph-canvas" 
        class="graph-canvas"
        bindtouchstart="onTouchStart"
        bindtouchmove="onTouchMove"
        bindtouchend="onTouchEnd"
      ></canvas>
      
      <!-- ÂõæË∞±Êìç‰ΩúÊèêÁ§∫ -->
      <view class="graph-controls">
        <view class="control-btn" bindtap="resetGraph">
          <text>‚Ü∫ Â§ç‰Ωç</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ËØ¶ÊÉÖÂç°Áâá (Bottom Sheet) -->
  <view class="detail-card {{showDetail ? 'show' : ''}}" catchtap="hideDetail">
    <view class="card-content" catchtap="stopPropagation">
      <view class="card-header-glass">
        <text class="card-title font-serif">{{selectedNode.label}}</text>
        <view class="card-close" bindtap="hideDetail">√ó</view>
      </view>
      
      <scroll-view scroll-y class="card-body">
        <view class="info-grid">
          <view class="info-item" wx:if="{{selectedNode.year}}">
            <text class="info-label">Êó∂Èó¥</text>
            <text class="info-value">{{selectedNode.year}}Âπ¥</text>
          </view>
          <view class="info-item" wx:if="{{selectedNode.location}}">
            <text class="info-label">Âú∞ÁÇπ</text>
            <text class="info-value">{{selectedNode.location}}</text>
          </view>
        </view>
        
        <view class="desc-section">
          <text class="section-title">ÁÆÄ‰ªã</text>
          <text class="desc-text">{{selectedNode.description}}</text>
        </view>
      </scroll-view>
      
      <view class="card-footer">
        <button class="ai-btn-large" bindtap="askAI">
          <text class="icon-ai">ü§ñ</text>
          <text>AI Ê∑±Â∫¶Ëß£Êûê</text>
        </button>
      </view>
    </view>
  </view>
</view>
