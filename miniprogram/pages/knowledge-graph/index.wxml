<!--pages/knowledge-graph/index.wxml-->
<navigation-bar title="ÂéÜÂè≤ÈïøÊ≤≥" showBack="{{true}}" showHome="{{true}}" background="transparent"></navigation-bar>

<view class="graph-page">
  <!-- È°∂ÈÉ®ÊéßÂà∂Ê†è (Glassmorphism) -->
  <view class="control-bar-glass animate-fade-in">
    <view class="search-bar">
      <text class="icon-search">üîç</text>
      <input class="search-input" placeholder="ÊêúÁ¥¢ÂéÜÂè≤‰∫ã‰ª∂/‰∫∫Áâ©" placeholder-class="search-placeholder" />
    </view>
    <view class="view-toggle">
      <view class="toggle-item {{currentView === 'timeline' ? 'active' : ''}}" bindtap="switchView" data-view="timeline">
        <text>Êó∂Èó¥ËΩ¥</text>
      </view>
      <view class="toggle-item {{currentView === 'graph' ? 'active' : ''}}" bindtap="switchView" data-view="graph">
        <text>ÊòüÁ≥ªÂõæ</text>
      </view>
    </view>
  </view>

  <!-- ËßÜÂõæÂÜÖÂÆπÂå∫Âüü -->
  <view class="view-container">
    
    <!-- 1. Êó∂Èó¥ËΩ¥ËßÜÂõæ (Timeline View) -->
    <scroll-view 
      wx:if="{{currentView === 'timeline'}}" 
      scroll-y 
      class="timeline-scroll animate-fade-in"
      enable-back-to-top
    >
      <view class="timeline-container">
        <view class="timeline-line"></view>
        
        <block wx:for="{{timelineData}}" wx:key="id">
          <view class="timeline-item {{index % 2 === 0 ? 'left' : 'right'}} animate-slide-up" style="animation-delay: {{index * 0.1}}s">
            <view class="timeline-dot">
              <view class="dot-core"></view>
              <view class="dot-ripple"></view>
            </view>
            <view class="timeline-content card-hover" bindtap="onEventTap" data-id="{{item.id}}">
              <view class="event-year font-serif">{{item.year}}</view>
              <view class="event-card">
                <image class="event-img" src="{{item.image}}" mode="aspectFill" lazy-load />
                <view class="event-info">
                  <text class="event-title">{{item.title}}</text>
                  <text class="event-desc">{{item.description}}</text>
                </view>
              </view>
            </view>
          </view>
        </block>
        
        <!-- Â∫ïÈÉ®ÁïôÁôΩ -->
        <view style="height: 120rpx;"></view>
      </view>
    </scroll-view>

    <!-- 2. Áü•ËØÜÂõæË∞±ËßÜÂõæ (Graph View) -->
    <view wx:if="{{currentView === 'graph'}}" class="graph-container animate-fade-in">
      <!-- ÊòüÁ©∫ËÉåÊôØ -->
      <view class="starry-bg"></view>
      
      <!-- Canvas Âå∫Âüü -->
      <canvas type="2d" id="knowledgeGraph" class="graph-canvas"
        bindtouchstart="onTouchStart"
        bindtouchmove="onTouchMove"
        bindtouchend="onTouchEnd"
      ></canvas>
      
      <!-- Â∫ïÈÉ®Âõæ‰æã -->
      <view class="legend-panel glass-panel">
        <view class="legend-item">
          <view class="dot event"></view>
          <text>‰∫ã‰ª∂</text>
        </view>
        <view class="legend-item">
          <view class="dot person"></view>
          <text>‰∫∫Áâ©</text>
        </view>
        <view class="legend-item">
          <view class="dot location"></view>
          <text>Âú∞ÁÇπ</text>
        </view>
      </view>
    </view>

  </view>
</view>
