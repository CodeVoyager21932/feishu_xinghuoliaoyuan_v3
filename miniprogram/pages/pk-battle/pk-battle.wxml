<!--pages/pk-battle/pk-battle.wxml-->
<navigation-bar title="çŸ¥è¯†å¯¹æˆ˜" showBack="{{true}}" showHome="{{true}}" background="transparent"></navigation-bar>
<view class="pk-battle-page">
  <!-- ç­”é¢˜æ¨¡å¼ -->
  <view class="quiz-mode" wx:if="{{mode === 'quiz'}}">
    <!-- é¡¶éƒ¨ä¿¡æ¯ -->
    <view class="quiz-header">
      <view class="timer {{timeLeft <= 10 ? 'warning' : ''}}">
        <text class="timer-icon">â±ï¸</text>
        <text class="timer-value">{{timeLeft}}s</text>
      </view>
      <view class="progress-bar">
        <view class="progress-fill" style="width: {{(currentIndex + 1) / questions.length * 100}}%;"></view>
      </view>
      <text class="progress-text">{{currentIndex + 1}}/{{questions.length}}</text>
    </view>

    <!-- é¢˜ç›®å¡ç‰‡ -->
    <view class="question-card">
      <text class="question-text">{{currentQuestion.question}}</text>
      
      <!-- é€‰é¡¹åˆ—è¡¨ -->
      <view class="options-list">
        <view 
          class="option-item {{selectedIndex === index ? 'selected' : ''}} {{answered && index === currentQuestion.correctIndex ? 'correct' : ''}} {{answered && selectedIndex === index && index !== currentQuestion.correctIndex ? 'wrong' : ''}}"
          wx:for="{{currentQuestion.options}}"
          wx:key="index"
          bindtap="onSelectOption"
          data-index="{{index}}"
        >
          <view class="option-label">{{['A', 'B', 'C', 'D'][index]}}</view>
          <text class="option-text">{{item}}</text>
          <view class="option-icon" wx:if="{{answered}}">
            <text wx:if="{{index === currentQuestion.correctIndex}}">âœ“</text>
            <text wx:elif="{{selectedIndex === index}}">âœ—</text>
          </view>
        </view>
      </view>

      <!-- è§£æ -->
      <view class="explanation" wx:if="{{answered}}">
        <text class="explanation-label">ğŸ’¡ è§£æ</text>
        <text class="explanation-text">{{currentQuestion.explanation}}</text>
      </view>
    </view>

    <!-- åº•éƒ¨æŒ‰é’® -->
    <view class="quiz-actions">
      <button class="btn-next" bindtap="onNextQuestion" wx:if="{{answered}}">
        {{currentIndex < questions.length - 1 ? 'ä¸‹ä¸€é¢˜' : 'æŸ¥çœ‹ç»“æœ'}}
      </button>
    </view>
  </view>

  <!-- ç»“ç®—é¡µé¢ -->
  <view class="result-mode" wx:if="{{mode === 'result'}}">
    <!-- èƒœè´Ÿæ ‡é¢˜ -->
    <view class="result-header {{isWin ? 'win' : 'lose'}}">
      <text class="result-title">{{isWin ? 'ğŸ‰ èƒœåˆ©ï¼' : 'ğŸ’ª æƒœè´¥'}}</text>
      <text class="result-subtitle">{{isWin ? 'ä½ æ˜¯é‡‘ç‰Œè®²è§£å‘˜ï¼' : 'ç»§ç»­åŠ æ²¹å­¦ä¹ ï¼'}}</text>
    </view>

    <!-- åˆ†æ•°å¯¹æ¯” -->
    <view class="score-comparison">
      <view class="player-score my-score">
        <image class="player-avatar" src="{{myInfo.avatarUrl}}" mode="aspectFill"></image>
        <text class="player-name">{{myInfo.nickName}}</text>
        <text class="score-value">{{myScore}}</text>
        <text class="score-label">åˆ†</text>
      </view>

      <view class="vs-divider">
        <text class="vs-text">VS</text>
        <view class="score-bars">
          <view class="score-bar my-bar" style="width: {{myScore / 100 * 100}}%;"></view>
          <view class="score-bar opponent-bar" style="width: {{opponentScore / 100 * 100}}%;"></view>
        </view>
      </view>

      <view class="player-score opponent-score">
        <image class="player-avatar" src="{{opponentInfo.avatarUrl}}" mode="aspectFill"></image>
        <text class="player-name">{{opponentInfo.nickName}}</text>
        <text class="score-value">{{opponentScore}}</text>
        <text class="score-label">åˆ†</text>
      </view>
    </view>

    <!-- å‹‹ç«  -->
    <view class="medal-section" wx:if="{{isWin}}">
      <view class="medal-icon">ğŸ…</view>
      <text class="medal-text">é‡‘ç‰Œè®²è§£å‘˜</text>
    </view>

    <!-- ç­”é¢˜è¯¦æƒ… -->
    <view class="answer-details">
      <view class="detail-item">
        <text class="detail-label">æ­£ç¡®ç‡</text>
        <text class="detail-value">{{correctRate}}%</text>
      </view>
      <view class="detail-item">
        <text class="detail-label">ç”¨æ—¶</text>
        <text class="detail-value">{{usedTime}}s</text>
      </view>
      <view class="detail-item">
        <text class="detail-label">ç­”å¯¹</text>
        <text class="detail-value">{{correctCount}}/{{questions.length}}</text>
      </view>
    </view>

    <!-- åº•éƒ¨æŒ‰é’® -->
    <view class="result-actions">
      <button class="btn-primary" bindtap="onChallenge">
        <text class="btn-icon">âš”ï¸</text>
        <text>ä¸æœï¼Ÿå‘TAå‘èµ·åå‡»</text>
      </button>
      <button class="btn-secondary" bindtap="onBackHome">
        è¿”å›é¦–é¡µ
      </button>
    </view>
  </view>
</view>
