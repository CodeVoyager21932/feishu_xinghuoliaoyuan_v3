# 测试与调试指南

## 🚀 快速开始

### 1. 使用微信开发者工具查看项目

#### 步骤1：打开项目
1. 下载并安装 [微信开发者工具](https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html)
2. 打开微信开发者工具
3. 选择"导入项目"
4. 项目目录选择：`C:\Users\72998\Desktop\xunfei\miniprogram`
5. AppID：选择"测试号"或输入你的小程序AppID

#### 步骤2：查看项目结构
在开发者工具左侧可以看到：
```
miniprogram/
├── pages/
│   ├── index/          ✅ 首页（已完成）
│   └── ai-chat/        ✅ AI对话（已完成）
├── utils/              ✅ 工具函数（已完成）
├── data/               ✅ 数据文件（已完成）
└── app.js/json/wxss    ✅ 全局配置（已完成）
```

#### 步骤3：查看页面效果
1. 点击"编译"按钮
2. 在模拟器中查看首页
3. 点击"AI讲解员"按钮跳转到对话页面

---

## 📱 当前可查看的页面

### ✅ 首页 (pages/index/index)

**可以看到**:
- 顶部用户信息栏（头像、昵称、打卡按钮）
- 今日英雄卡片
- 功能入口网格（4个按钮）
- 学习统计卡片

**注意事项**:
- ⚠️ 图片资源缺失，会显示占位符或加载失败
- ⚠️ 用户信息需要授权登录才能显示
- ⚠️ 统计数据需要云函数支持

**临时解决方案**:
```javascript
// 在 index.js 中使用模拟数据
data: {
  userInfo: {
    nickName: '测试用户',
    avatarUrl: 'https://via.placeholder.com/100'
  },
  stats: {
    continuous_days: 7,
    mastered_cards: 25,
    ai_chat_count: 50
  }
}
```

---

### ✅ AI对话页面 (pages/ai-chat/index)

**可以看到**:
- 顶部导航栏（AI头像、名称、切换按钮）
- 欢迎消息
- 消息列表区域
- 底部输入框和发送按钮
- 英雄选择弹窗（点击"切换英雄"按钮）

**可以测试的交互**:
1. ✅ 输入文字（输入框会响应）
2. ✅ 点击发送按钮（会显示加载动画）
3. ✅ 点击"切换英雄"按钮（弹出英雄选择窗）
4. ✅ 选择英雄（切换到英雄对话模式）
5. ✅ 消息滚动（自动滚动到最新消息）

**注意事项**:
- ⚠️ 发送消息会调用云函数，需要配置云开发
- ⚠️ 没有配置讯飞星火API，会返回错误提示
- ⚠️ 英雄头像图片缺失

**临时测试方案**:
在 `pages/ai-chat/index.js` 中添加模拟回复：

```javascript
// 在 onSend 方法中，注释掉云函数调用，添加模拟回复
async onSend() {
  // ... 添加用户消息的代码 ...
  
  // 模拟AI回复（用于测试UI）
  setTimeout(() => {
    const aiMessage = {
      role: 'assistant',
      content: '这是一个模拟回复。南昌起义发生在1927年8月1日，打响了武装反抗国民党反动派的第一枪...',
      time: this.formatTime(new Date())
    };
    
    this.setData({
      messages: [...this.data.messages, aiMessage],
      isLoading: false
    });
    
    this.scrollToBottom();
  }, 2000); // 2秒后返回模拟回复
}
```

---

## 🎨 UI效果预览

### 首页效果
```
┌─────────────────────────────────┐
│  👤 用户昵称        [打卡] 按钮  │
├─────────────────────────────────┤
│  ┌───────────────────────────┐  │
│  │  今日英雄：雷锋            │  │
│  │  伟大的共产主义战士        │  │
│  └───────────────────────────┘  │
├─────────────────────────────────┤
│  ┌──────┐  ┌──────┐            │
│  │ AI   │  │ 图谱 │            │
│  │讲解员│  │      │            │
│  └──────┘  └──────┘            │
│  ┌──────┐  ┌──────┐            │
│  │ 卡片 │  │ 英雄 │            │
│  │学习  │  │长廊  │            │
│  └──────┘  └──────┘            │
├─────────────────────────────────┤
│  学习统计                       │
│  连续打卡: 7天                  │
│  掌握卡片: 25张                 │
│  AI问答: 50次                   │
└─────────────────────────────────┘
```

### AI对话页面效果
```
┌─────────────────────────────────┐
│  🤖 星火同志  [切换英雄]        │
│     党史专家·金牌导游           │
├─────────────────────────────────┤
│                                 │
│  ┌─────────────────────────┐   │
│  │ 你好！我是星火同志...    │   │
│  └─────────────────────────┘   │
│                                 │
│              ┌──────────────┐  │
│              │ 南昌起义是   │  │
│              │ 什么时候？   │  │
│              └──────────────┘  │
│                                 │
│  ┌─────────────────────────┐   │
│  │ 南昌起义发生在1927年... │   │
│  └─────────────────────────┘   │
│                                 │
├─────────────────────────────────┤
│  [输入框]              [发送]   │
└─────────────────────────────────┘
```

---

## 🔧 调试技巧

### 1. 查看控制台日志
在微信开发者工具中：
- 点击"调试器"标签
- 查看 Console 面板
- 可以看到所有 `console.log` 输出

### 2. 查看网络请求
- 点击"Network"标签
- 可以看到所有云函数调用
- 查看请求参数和返回结果

### 3. 查看本地存储
- 点击"Storage"标签
- 查看 Storage 面板
- 可以看到缓存的数据

### 4. 实时修改代码
- 修改代码后自动编译
- 模拟器会自动刷新
- 支持热重载

### 5. 模拟不同设备
- 点击模拟器顶部的设备选择
- 可以切换 iPhone、Android 等设备
- 查看不同屏幕尺寸的效果

---

## 🐛 常见问题排查

### 问题1：页面显示空白
**原因**: 可能是路径配置错误或页面未注册

**解决**:
1. 检查 `app.json` 中的 pages 配置
2. 确保页面文件存在
3. 查看控制台错误信息

### 问题2：图片不显示
**原因**: 图片资源缺失

**临时解决**:
1. 使用在线图片URL
2. 使用占位图片
3. 使用纯色背景代替

```javascript
// 使用在线占位图
avatar: 'https://via.placeholder.com/100'
```

### 问题3：云函数调用失败
**原因**: 云开发环境未初始化

**解决**:
1. 在微信开发者工具中开通云开发
2. 创建云开发环境
3. 在 `app.js` 中配置环境ID
4. 部署云函数

**临时解决**: 使用模拟数据（见上文）

### 问题4：样式显示异常
**原因**: rpx单位或样式冲突

**解决**:
1. 检查 wxss 文件
2. 使用开发者工具的"样式"面板调试
3. 查看元素的实际样式

---

## 📊 功能测试清单

### ✅ 已完成功能测试

#### 首页
- [ ] 页面正常加载
- [ ] 用户信息显示
- [ ] 今日英雄卡片显示
- [ ] 功能按钮可点击
- [ ] 统计数据显示
- [ ] 打卡按钮响应

#### AI对话页面
- [ ] 页面正常加载
- [ ] 欢迎消息显示
- [ ] 输入框可输入
- [ ] 发送按钮响应
- [ ] 加载动画显示
- [ ] 消息气泡正常显示
- [ ] 消息自动滚动
- [ ] 英雄选择弹窗显示
- [ ] 英雄切换功能
- [ ] 对话历史保存

---

## 🎯 下一步测试计划

### 待完成功能测试

1. **云函数集成测试**
   - 配置讯飞星火API
   - 测试AI对话功能
   - 测试Function Call
   - 测试对话历史存储

2. **完整流程测试**
   - 用户登录流程
   - AI对话完整流程
   - 英雄对话模式切换
   - 数据持久化

3. **性能测试**
   - 页面加载速度
   - 对话响应时间
   - 内存占用
   - 网络请求优化

---

## 📝 测试记录模板

```markdown
### 测试日期：2025-11-19
### 测试人员：[你的名字]
### 测试环境：微信开发者工具 / 真机

#### 测试项目：首页显示
- 测试结果：✅ 通过 / ❌ 失败
- 问题描述：[如有问题，详细描述]
- 截图：[如有必要，添加截图]

#### 测试项目：AI对话
- 测试结果：✅ 通过 / ❌ 失败
- 问题描述：[如有问题，详细描述]
- 截图：[如有必要，添加截图]
```

---

## 🔗 相关资源

- [微信小程序开发文档](https://developers.weixin.qq.com/miniprogram/dev/framework/)
- [微信开发者工具使用指南](https://developers.weixin.qq.com/miniprogram/dev/devtools/devtools.html)
- [云开发文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/basis/getting-started.html)
- [讯飞星火API文档](https://www.xfyun.cn/doc/spark/Web.html)
