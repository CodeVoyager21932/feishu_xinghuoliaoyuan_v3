# 红色信物收集系统开发文档

## 功能概述
"红色信物收集系统"是一个游戏化的学习激励机制，让用户通过学习党史获得积分，消耗积分开启"机密档案"抽取革命纪念物，建立个人的"红色珍藏馆"。

## 核心设计理念

### 1. 文化定位
- **不是古代文物**：特指与党史相关的革命信物
- **历史见证物**：每件信物都承载着真实的历史故事
- **教育价值**：通过收集激发学习兴趣，深化历史认知

### 2. 游戏化机制
- **盲盒抽取**：增加惊喜感和期待感
- **稀有度系统**：SSR/SR/R 三级稀有度
- **碎片转换**：重复信物转化为碎片，避免浪费
- **收集成就**：完成度统计，激励持续学习

---

## 技术架构

### 数据层
```
miniprogram/data/relics.js          # 信物基础数据（24件）
cloud/database/
  ├── relics                        # 信物表（可选云端存储）
  ├── user_relics                   # 用户收集记录
  └── draw_history                  # 抽奖历史
```

### 云函数
```
cloud/functions/draw-relic/         # 抽奖云函数
  ├── index.js                      # 核心逻辑
  ├── package.json
  └── config.json
```

### 前端页面
```
miniprogram/pages/
  ├── mystery-box/                  # 机密档案（抽奖页）
  │   ├── mystery-box.wxml
  │   ├── mystery-box.js
  │   ├── mystery-box.wxss
  │   └── mystery-box.json
  └── museum/                       # 红色珍藏馆
      ├── museum.wxml
      ├── museum.js
      ├── museum.wxss
      └── museum.json
```

---

## 核心功能详解

### 1. 机密档案（抽奖页面）

#### UI 设计
- **视觉隐喻**：军用补给箱 / 机密档案袋
- **交互反馈**：
  - 点击：震动反馈
  - 开启中：箱子震动动画
  - 结果展示：稀有度光效 + 弹窗

#### 抽奖流程
```
用户点击 → 检查积分 → 调用云函数 → 权重随机 → 扣除积分 → 
更新收集记录 → 显示结果 → 保存历史
```

#### 关键代码
```javascript
// 权重随机算法
function drawRarity() {
  const random = Math.random() * 100;
  let cumulative = 0;
  
  for (const [rarity, weight] of Object.entries(RARITY_WEIGHTS)) {
    cumulative += weight;
    if (random < cumulative) {
      return rarity;
    }
  }
  return 'R';
}
```

---

### 2. 红色珍藏馆

#### 展示方式
- **横向滚动展厅**：模拟博物馆参观体验
- **卡片式布局**：每件信物独立卡片
- **未拥有状态**：显示锁定图标和"???"

#### 筛选功能
- 全部
- 传说（SSR）
- 稀有（SR）
- 普通（R）

#### 统计数据
- 已收集数量
- 总计数量
- 收集率百分比

---

### 3. 信物数据结构

#### 24 件信物清单

**SSR 级别（4件）**：
1. 南湖红船模型
2. 井冈山八角楼油灯
3. 长征草鞋
4. 开国大典礼炮

**SR 级别（6件）**：
1. 雷锋日记
2. 抗联冲锋号
3. 延安窑洞煤油灯
4. 焦裕禄的藤椅
5. 红军军号
6. 《新青年》杂志

**R 级别（10件）**：
1. 红军斗笠
2. 红缨枪
3. 军用水壶
4. 红星帽徽
5. 抗战传单
6. 识字课本
7. 军用背包
8. 党员证
9. 军用饭盒
10. 红旗

#### 数据字段
```javascript
{
  id: 'relic_ssr_001',
  name: '南湖红船模型',
  rarity: 'SSR',
  image: '/images/relics/red-boat.png',
  related_hero_id: 'hero_001',
  related_event: '中共一大',
  story: '1921年7月，中国共产党...',
  year: 1921,
  category: '革命遗物'
}
```

---

## 权重与经济系统

### 稀有度概率
| 稀有度 | 概率 | 颜色 | 重复碎片 |
|--------|------|------|----------|
| SSR    | 5%   | 红色 | 50       |
| SR     | 25%  | 紫色 | 20       |
| R      | 70%  | 蓝色 | 5        |

### 积分系统
**消耗**：
- 每次抽取：100 积分

**获取**：
- 每日签到：+10
- 完成卡片学习：+5/张
- AI 对话互动：+2/次
- 连续打卡奖励：+30/50/200

---

## 联动设计

### 1. 信物 → 英雄
点击信物详情，可跳转到关联英雄的详情页。

**示例**：
- 雷锋日记 → 雷锋英雄详情
- 焦裕禄的藤椅 → 焦裕禄英雄详情

### 2. 信物 → 事件
点击信物详情，可查看关联的历史事件。

**示例**：
- 南湖红船 → 中共一大事件
- 长征草鞋 → 长征事件

### 3. 首页入口
在首页功能网格中添加"机密档案"入口。

---

## 视觉设计规范

### 色彩方案
```css
/* SSR - 传说 */
--ssr-gradient: linear-gradient(135deg, #FF6B6B 0%, #FF8E53 100%);
--ssr-glow: rgba(255, 107, 107, 0.5);

/* SR - 稀有 */
--sr-gradient: linear-gradient(135deg, #A78BFA 0%, #EC4899 100%);
--sr-glow: rgba(167, 139, 250, 0.5);

/* R - 普通 */
--r-gradient: linear-gradient(135deg, #60A5FA 0%, #3B82F6 100%);
--r-glow: rgba(96, 165, 250, 0.5);
```

### 动画效果
- **抽奖中**：箱子震动（shake）
- **结果展示**：缩放弹入（scaleIn）
- **光效**：脉冲呼吸（pulse）
- **卡片**：悬停放大（hover scale）

---

## 部署步骤

### 1. 初始化数据库
参考 `cloud/database/relics_init.md` 创建集合和索引。

### 2. 部署云函数
```bash
# 在微信开发者工具中
# 右键 cloud/functions/draw-relic
# 选择"上传并部署：云端安装依赖"
```

### 3. 准备图片资源
将信物图片上传到 `miniprogram/images/relics/` 目录：
- 尺寸：512×512px
- 格式：PNG（透明背景）
- 命名：与数据中的 `image` 字段对应

### 4. 注册页面路由
在 `app.json` 中添加页面路径（已完成）。

### 5. 添加首页入口
在首页功能网格中添加"机密档案"按钮。

---

## 测试指南

### 1. 本地测试
```javascript
// 模拟用户积分
wx.setStorageSync('userStats', {
  points: 1000
});

// 测试抽奖
this.onDrawRelic();
```

### 2. 云函数测试
在云开发控制台 → 云函数 → draw-relic → 测试：
```json
{}
```

### 3. 概率验证
抽取 100 次，统计各稀有度出现次数，验证概率是否符合预期。

---

## 扩展功能建议

### 1. 碎片合成
积累足够碎片可合成新信物：
- SSR：需要 500 碎片
- SR：需要 200 碎片
- R：需要 50 碎片

### 2. 信物图鉴
完整的信物百科，包含：
- 高清大图
- 详细历史背景
- 相关文献资料
- 3D 模型展示

### 3. 成就系统
- 收集家：收集全部信物
- 传说猎人：收集全部 SSR
- 幸运儿：单次抽中 SSR
- 坚持者：连续抽取 100 次

### 4. 社交功能
- 信物展示墙
- 好友收集对比
- 信物交换系统

---

## 注意事项

### 1. 文化敏感性
- 所有信物必须基于真实历史
- 故事描述需经过审核
- 避免娱乐化、低俗化

### 2. 经济平衡
- 积分获取与消耗比例合理
- 避免过度氪金倾向
- 保证普通用户也能收集

### 3. 性能优化
- 图片懒加载
- 数据分页加载
- 缓存用户收集记录

---

## 相关文档

- [数据库初始化文档](../cloud/database/relics_init.md)
- [信物数据文件](../miniprogram/data/relics.js)
- [抽奖云函数](../cloud/functions/draw-relic/index.js)

---

**开发完成后，请进行完整的功能测试和用户体验测试！**
