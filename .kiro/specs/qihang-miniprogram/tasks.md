# 实施计划 - "星火"红色教育智能体小程序

## 开发时间线

**总计：7天**
- Day 1-2：项目初始化 + AI对话模块
- Day 3-4：知识图谱模块
- Day 5：Tinder卡片学习模块
- Day 6：英雄长廊 + 用户系统
- Day 7：测试优化 + 部署

---

## 任务清单

- [-] 1. 项目初始化与基础架构搭建

  - 创建微信小程序项目，配置AppID和云开发环境
  - 搭建项目目录结构（pages、components、utils、cloud）
  - 配置微信云开发，初始化云函数、云数据库和云存储
  - 设计并实现全局样式系统（色彩、字体、组件样式）
  - 实现用户登录功能（微信授权登录）
  - _需求: 1_

- [ ] 2. AI虚拟讲解员核心功能实现
  - [ ] 2.1 创建AI对话页面UI
    - 实现对话界面布局（消息列表、输入框、头像）
    - 实现消息气泡组件（用户消息、AI消息）
    - 实现加载动画（思考中提示）
    - _需求: 2_
  
  - [ ] 2.2 实现BFF中间层云函数
    - 创建`ai-chat`云函数，处理API鉴权和签名
    - 实现讯飞星火API调用逻辑（HMAC-SHA256签名）
    - 实现对话历史管理（限制10轮）
    - 实现敏感词过滤功能
    - _需求: 2_
  
  - [ ] 2.3 设计并实现System Prompt
    - 编写"星火同志"的基础Prompt模板
    - 实现思维链（CoT）推理机制
    - 编写至少3个英雄人物的Persona Prompt（雷锋、焦裕禄、冷云）
    - 实现对话模式切换功能（普通模式/英雄对话模式）
    - _需求: 2_
  
  - [ ] 2.4 实现Function Call零幻觉机制
    - 准备结构化知识库JSON文件（50位英雄、100个事件）
    - 定义工具函数（get_hero_biography、query_historical_event）
    - 实现Function Call调用流程（意图识别→函数执行→二次生成）
    - 实现规则匹配机制，确保关键历史定论准确无误
    - _需求: 2.1_
  
  - [ ] 2.5 实现对话历史存储
    - 创建chat_history数据库集合
    - 实现对话记录保存功能
    - 实现对话历史加载功能（展示最近20条）
    - _需求: 2_

- [ ] 3. 党史知识图谱可视化系统
  - [ ] 3.1 准备图谱数据
    - 设计图谱数据模型（nodes、edges）
    - 准备50个历史节点数据（人物、事件、组织）
    - 准备100条关系数据（PARTICIPATED_IN、NEXT_EVENT等）
    - 将数据上传到云存储（graph.json）
    - _需求: 3_
  
  - [ ] 3.2 集成AntV G6图可视化引擎
    - 安装AntV G6微信小程序版
    - 创建知识图谱页面，初始化Canvas画布
    - 配置G6基础参数（宽高、交互模式）
    - 实现图谱数据加载功能
    - _需求: 3_
  
  - [ ] 3.3 实现时间轴布局算法
    - 配置力导向布局（force layout）
    - 实现X轴时间定位力（将1921-2024映射到X轴）
    - 实现聚类力（同一事件相关人物聚合）
    - 调试布局参数，优化视觉效果
    - _需求: 3_
  
  - [ ] 3.4 实现焦点上下文交互
    - 实现节点点击事件监听
    - 实现关联节点高亮逻辑（降低非关联节点透明度）
    - 实现关联边高亮逻辑
    - 实现详情卡片弹出动画
    - _需求: 3_
  
  - [ ] 3.5 实现图谱筛选功能
    - 实现顶部筛选按钮（全部、革命时期、建设时期、改革时期）
    - 实现筛选逻辑（根据时期过滤节点）
    - 实现图谱重新渲染
    - _需求: 3_
  
  - [ ] 3.6 实现图谱与AI对话联动
    - 在详情卡片中添加"AI详解"按钮
    - 实现跳转到AI对话页面并自动提问功能
    - _需求: 3_

- [ ] 4. Tinder式卡片学习模块
  - [ ] 4.1 准备卡片数据
    - 设计卡片数据模型（front_image、back_content等）
    - 准备50张红色记忆卡数据
    - 收集并压缩卡片正面图片（控制在100KB以内）
    - 将数据上传到云存储（cards.json）
    - _需求: 5_
  
  - [ ] 4.2 实现卡片UI组件
    - 创建卡片学习页面
    - 使用movable-view实现卡片滑动组件
    - 实现卡片正反面翻转动画
    - 实现卡片飞出动画（左滑/右滑）
    - _需求: 5_
  
  - [ ] 4.3 实现卡片滑动逻辑
    - 实现滑动阈值判断（左滑/右滑/回弹）
    - 实现左滑标记为"待复习"
    - 实现右滑标记为"已掌握"
    - 实现星火动画效果（右滑时）
    - _需求: 5_
  
  - [ ] 4.4 实现艾宾浩斯遗忘曲线算法
    - 实现复习间隔计算函数（5分钟、1小时、1天）
    - 实现复习队列管理
    - 实现到期卡片自动推送
    - _需求: 5_
  
  - [ ] 4.5 实现学习记录存储
    - 创建learning_records数据库集合
    - 实现学习记录保存功能（卡片状态、复习时间）
    - 实现学习进度统计功能
    - _需求: 5_
  
  - [ ] 4.6 实现卡片AI详解功能
    - 在卡片背面添加"AI详解"按钮
    - 调用讯飞星火API生成知识点详细讲解
    - 实现详解内容展示
    - _需求: 5_

- [ ] 5. 英雄长廊模块
  - [ ] 5.1 准备英雄数据
    - 准备30位英雄人物数据（姓名、头像、简介、生平事迹）
    - 收集并压缩英雄头像图片
    - 将数据上传到云存储（heroes.json）
    - _需求: 4_
  
  - [ ] 5.2 实现英雄列表页面
    - 创建英雄长廊页面
    - 实现卡片列表布局（头像、姓名、时代标签、简介）
    - 实现按时代筛选功能（革命、建设、改革、新时代）
    - 实现列表滚动加载
    - _需求: 4_
  
  - [ ] 5.3 实现英雄详情页面
    - 创建英雄详情页面
    - 实现详情页布局（头像、生平、贡献、评价、图片）
    - 实现"与英雄对话"按钮
    - 实现跳转到AI对话页面并切换为英雄模式
    - _需求: 4_
  
  - [ ] 5.4 实现"今日英雄"功能
    - 实现每日推荐算法（基于日期随机选择）
    - 在首页展示"今日英雄"卡片
    - 实现点击跳转到英雄详情
    - _需求: 4_

- [ ] 6. 用户系统与个人中心
  - [ ] 6.1 实现用户数据模型
    - 创建users数据库集合
    - 实现用户信息存储（openid、昵称、头像、学习统计）
    - 实现用户信息更新功能
    - _需求: 1_
  
  - [ ] 6.2 实现学习打卡功能
    - 创建check_in数据库集合
    - 实现打卡按钮和打卡逻辑
    - 实现连续打卡天数计算
    - 实现打卡成功动画
    - _需求: 6_
  
  - [ ] 6.3 实现成就系统
    - 设计成就徽章数据（首次登录、连续打卡7天、掌握50张卡片等）
    - 实现成就解锁逻辑
    - 实现成就徽章展示页面
    - 实现成就解锁弹窗动画
    - _需求: 6_
  
  - [ ] 6.4 实现个人中心页面
    - 创建个人中心页面
    - 实现用户信息展示（昵称、头像）
    - 实现学习统计展示（学习天数、问答次数、掌握卡片数）
    - 实现成就徽章展示
    - _需求: 1, 6_

- [ ] 7. 首页与导航
  - [ ] 7.1 实现首页布局
    - 创建首页
    - 实现顶部用户信息栏（头像、昵称、打卡按钮）
    - 实现"今日英雄"卡片
    - 实现功能入口网格（AI讲解员、知识图谱、卡片学习、英雄长廊）
    - 实现学习统计卡片
    - _需求: 1, 4_
  
  - [ ] 7.2 实现底部导航栏
    - 配置tabBar（首页、知识图谱、卡片学习、个人中心）
    - 设计并添加导航图标
    - 配置页面路由
    - _需求: 1_

- [ ] 8. 性能优化与测试
  - [ ] 8.1 实现图片优化
    - 压缩所有图片资源（TinyPNG）
    - 实现图片懒加载
    - 配置云存储CDN加速
    - _需求: 性能需求_
  
  - [ ] 8.2 实现数据缓存
    - 实现本地缓存工具函数
    - 缓存英雄数据、图谱数据、卡片数据（24小时有效期）
    - 实现缓存过期自动刷新
    - _需求: 性能需求_
  
  - [ ] 8.3 实现错误处理
    - 实现全局错误处理函数
    - 实现用户友好的错误提示
    - 实现错误日志上报
    - _需求: 可维护性需求_
  
  - [ ] 8.4 功能测试
    - 测试AI对话功能（普通模式、英雄模式、Function Call）
    - 测试知识图谱交互（点击、缩放、拖拽、筛选）
    - 测试卡片学习功能（滑动、翻转、复习推送）
    - 测试英雄长廊功能（列表、详情、筛选）
    - 测试用户系统（登录、打卡、成就）
    - _需求: 所有功能需求_
  
  - [ ] 8.5 性能测试
    - 测试首页加载时间（目标<2秒）
    - 测试AI响应时间（目标<5秒）
    - 测试知识图谱渲染性能（目标无明显卡顿）
    - 测试不同设备兼容性（iOS、Android）
    - _需求: 性能需求_

- [ ] 9. 部署与发布
  - [ ] 9.1 数据初始化
    - 上传所有JSON数据文件到云存储
    - 上传所有图片资源到云存储
    - 初始化数据库集合和索引
    - _需求: 所有功能需求_
  
  - [ ] 9.2 云函数部署
    - 部署ai-chat云函数
    - 部署get-graph-data云函数
    - 部署get-hero-list、get-hero-detail云函数
    - 部署get-card-list、update-learning-record云函数
    - 部署check-in、get-user-stats云函数
    - _需求: 所有功能需求_
  
  - [ ] 9.3 小程序发布
    - 配置小程序基本信息（名称、图标、描述）
    - 配置服务器域名白名单
    - 上传小程序代码
    - 提交审核
    - _需求: 所有功能需求_
  
  - [ ] 9.4 准备演示材料
    - 录制功能演示视频（3-5分钟）
    - 准备PPT演示文稿（技术亮点、创新点）
    - 准备答辩问题预案
    - _需求: 竞赛需求_

---

## 任务优先级说明

**P0（必须完成）**：
- 任务1：项目初始化
- 任务2：AI虚拟讲解员
- 任务3：知识图谱
- 任务4：Tinder卡片学习
- 任务7：首页与导航
- 任务9：部署与发布

**P1（尽量完成）**：
- 任务5：英雄长廊
- 任务6：用户系统
- 任务8：性能优化与测试

**如果时间紧张，可以简化或延后的功能**：
- 成就系统（任务6.3）
- 卡片AI详解（任务4.6）
- 图谱筛选功能（任务3.5）

---

## 开发建议

1. **并行开发**：AI对话、知识图谱、卡片学习三个模块可以并行开发
2. **数据优先**：先准备好所有JSON数据，再开发功能
3. **快速迭代**：每完成一个模块立即测试，不要等到最后
4. **使用AI辅助**：充分利用Vibe Coding，让AI生成重复性代码
5. **保持简单**：遇到复杂问题优先选择简单方案，不要过度设计

---

## 风险与应对

| 风险 | 应对措施 |
|------|---------|
| 讯飞星火API调用失败 | 准备备用方案（使用本地规则回答） |
| AntV G6性能问题 | 减少节点数量，简化布局算法 |
| 时间不够 | 砍掉P1优先级功能，聚焦核心亮点 |
| 数据准备耗时 | 使用AI生成模拟数据 |
| 审核不通过 | 提前准备资质材料，确保内容合规 |
