# 需求文档 - "星火"红色教育智能体小程序（一周MVP版）

## 项目简介

"星火"是一个基于认知智能的红色党史学习平台，旨在响应国家"传承红色基因、赓续红色血脉"的号召，为中国青少年学生打造一个多模态、强交互的红色文化学习解决方案。本项目通过讯飞星火大模型驱动的AI虚拟讲解员、知识图谱可视化、游戏化学习机制等创新技术，将红色历史从"单向灌输"转变为"沉浸式智能互动"。

**战略定位**：面向"挑战杯"等国家级竞赛，在Prompt Engineering、Function Call零幻觉机制、知识图谱时间轴布局、Tinder式游戏化学习等方面体现技术创新能力。

**开发周期**：7天MVP版本，采用Vibe Coding（AI辅助开发）方式快速迭代。

**核心技术亮点**：
1. 基于Function Call的"零幻觉"AI讲解员
2. 时间轴布局的党史知识图谱
3. 艾宾浩斯遗忘曲线驱动的Tinder式卡片学习

## 术语表

- **小程序系统**：指"星火"红色教育微信小程序的整体应用
- **星火同志**：基于讯飞星火4.0 Ultra大模型的AI虚拟讲解员
- **BFF中间层**：Backend for Frontend，位于小程序前端与AI模型之间的中间服务层
- **Function Call**：讯飞星火API的函数调用功能，用于连接本地结构化数据，实现"零幻觉"知识检索
- **思维链（CoT）**：Chain of Thought，通过分步推理提升AI回答逻辑性的Prompt技术
- **知识图谱**：基于复杂网络理论的党史知识可视化系统，包含实体和关系的图结构
- **时间轴布局**：在知识图谱中按时间顺序排列历史事件的创新布局算法
- **Tinder式交互**：借鉴Tinder应用的卡片滑动交互模式，用于碎片化知识学习
- **艾宾浩斯遗忘曲线**：用于设计知识复习推送算法的心理学理论
- **AntV G6**：蚂蚁集团开源的图可视化引擎，支持微信小程序
- **用户**：使用本小程序的学生
- **云端服务**：基于Serverless架构部署的后端API服务
- **讯飞星火API**：科大讯飞提供的Spark 4.0 Ultra大语言模型接口服务

## 需求

### 需求 1：用户认证与个人中心

**用户故事**：作为一名学生，我希望能够登录小程序并查看我的学习记录，以便追踪我的学习进度和成就。

#### 验收标准

1. WHEN 用户首次打开小程序，THE 小程序系统 SHALL 显示欢迎页面和微信授权登录按钮
2. WHEN 用户点击授权登录按钮，THE 小程序系统 SHALL 获取用户的微信昵称和头像并创建用户账号
3. WHEN 用户登录成功后，THE 小程序系统 SHALL 跳转到首页并在顶部显示用户头像
4. THE 小程序系统 SHALL 提供个人中心页面，展示用户的昵称、头像和学习统计数据
5. THE 小程序系统 SHALL 在个人中心展示用户的累计学习天数、AI问答次数、掌握卡片数量和连续打卡天数
6. THE 小程序系统 SHALL 在个人中心展示用户获得的成就徽章（如"连续打卡7天"、"掌握100张卡片"）

---

### 需求 2：基于讯飞星火大模型的AI虚拟讲解员系统

**用户故事**：作为一名学生，我希望能够与"星火同志"AI讲解员进行自然对话，提问红色历史问题并获得准确、生动的回答，甚至能与历史英雄人物进行角色扮演对话，以便深入了解革命历史和英雄精神。

#### 验收标准

1. THE 小程序系统 SHALL 提供AI对话页面，包含文字输入框、消息展示区域和"星火同志"虚拟讲解员头像
2. THE 云端服务 SHALL 采用BFF（Backend for Frontend）架构，在中间层处理API Key签名加密和敏感词过滤
3. WHEN 用户在输入框中输入问题并点击发送，THE 小程序系统 SHALL 将问题发送至BFF中间层
4. WHEN BFF中间层接收到问题，THE 云端服务 SHALL 调用讯飞星火4.0 Ultra API，使用精心设计的System Prompt确保回答符合"星火同志"的人设（资深党史研究员+金牌导游）
5. THE 云端服务 SHALL 限制对话历史为最近10轮，以控制Token成本
6. WHEN 云端服务获得AI回答后，THE 小程序系统 SHALL 在对话界面中以消息气泡形式展示回答内容
7. WHILE 等待AI回答期间，THE 小程序系统 SHALL 显示"思考中..."的加载提示
8. THE 小程序系统 SHALL 保存用户的对话历史记录，并在对话界面中展示最近20条消息
9. THE 云端服务 SHALL 实现思维链（CoT）推理机制，对复杂问题进行分步推理：背景分析→决策过程→行动细节→历史意义推导
10. THE 小程序系统 SHALL 提供"与英雄对话"功能入口，用户可选择特定英雄人物（如雷锋、焦裕禄、冷云等）进行角色扮演对话
11. WHEN 用户选择与特定英雄对话时，THE 云端服务 SHALL 动态调整System Prompt，使回答符合该英雄的语言风格和时代背景

---

### 需求 2.1：基于Function Call的"零幻觉"知识检索

**用户故事**：作为一名学生，我希望AI讲解员提供的历史事实绝对准确，不会出现编造或错误信息，以便我能够信任并学习正确的党史知识。

#### 验收标准

1. THE 云端服务 SHALL 准备结构化的党史知识库（JSON格式），包含至少50位英雄人物、100个历史事件的准确信息
2. THE 云端服务 SHALL 在调用讯飞星火API时定义工具函数（Tools），包括`get_hero_biography`（获取英雄生平）、`query_historical_event`（查询历史事件）
3. WHEN 用户提问涉及具体人物或事件时（如"雷锋是谁"），THE 云端服务 SHALL 通过意图识别判断是否需要调用Function Call
4. WHEN 讯飞星火API返回Function Call指令时，THE BFF中间层 SHALL 解析函数名和参数，从本地JSON文件中查询准确数据
5. THE 云端服务 SHALL 将检索到的结构化数据回传给讯飞星火API进行二次生成，将枯燥数据润色为生动讲述
6. THE 云端服务 SHALL 确保所有涉及时间、地点、人物、事件的描述基于官方党史资料，严禁AI杜撰或猜测

---

### 需求 3：党史知识图谱可视化系统

**用户故事**：作为一名学生，我希望能够通过可交互的知识图谱浏览党史百年大事记，直观地看到历史事件、人物之间的关联，以便系统性地理解中国革命历史的发展脉络。

#### 验收标准

1. THE 云端服务 SHALL 构建红色党史知识图谱数据，包含三类实体：Person（人物）、Event（事件）、Organization（组织）
2. THE 云端服务 SHALL 定义实体间的关系类型，包括`PARTICIPATED_IN`（人物参加事件）、`NEXT_EVENT`（事件时序关联）、`MEMBER_OF`（人物所属组织）
3. THE 小程序系统 SHALL 使用AntV G6图可视化引擎（微信小程序版）实现知识图谱渲染
4. THE 小程序系统 SHALL 实现时间轴布局算法，在X轴方向按时间顺序排列1921年至今的历史事件，形成"历史长河"视觉效果
5. WHEN 用户进入知识图谱页面，THE 小程序系统 SHALL 加载并显示至少50个重要历史节点和100条关系连线
6. WHEN 用户点击某个历史节点，THE 小程序系统 SHALL 高亮显示该节点及其直接关联节点，并在底部弹出详情卡片
7. THE 小程序系统 SHALL 在详情卡片中展示事件的时间、地点、关键人物和历史意义
8. THE 小程序系统 SHALL 支持用户通过双指缩放和拖拽操作浏览知识图谱
9. THE 小程序系统 SHALL 提供"筛选"功能，用户可按时期（革命时期、建设时期、改革时期）筛选显示的节点
10. THE 小程序系统 SHALL 在知识图谱页面提供"AI讲解"按钮，点击后跳转到AI对话界面并自动提问当前选中事件的背景

---

### 需求 4：英雄长廊

**用户故事**：作为一名学生，我希望能够浏览革命英雄和时代楷模的事迹，以便学习他们的精神品质和价值观。

#### 验收标准

1. THE 小程序系统 SHALL 提供英雄长廊页面，展示至少30位革命英雄和时代楷模
2. WHEN 用户进入英雄长廊页面，THE 小程序系统 SHALL 以卡片列表形式展示英雄人物，每张卡片包含头像、姓名、时代标签和一句话简介
3. THE 小程序系统 SHALL 支持按时代筛选英雄人物，包括"革命时期"、"建设时期"、"改革时期"和"新时代"
4. WHEN 用户点击某位英雄的卡片，THE 小程序系统 SHALL 跳转到英雄详情页面
5. THE 小程序系统 SHALL 在英雄详情页面展示英雄的生平事迹、主要贡献、历史评价和相关图片
6. THE 小程序系统 SHALL 在英雄详情页面提供"与英雄对话"按钮，点击后跳转到AI问答界面并自动切换为该英雄的对话模式
7. THE 小程序系统 SHALL 在首页展示"今日英雄"卡片，每日推荐一位英雄人物及其代表性事迹

---

### 需求 5："星火燎原"Tinder式卡片滑动学习

**用户故事**：作为一名学生，我希望能够通过有趣的卡片滑动方式进行碎片化学习，并且系统能够根据我的掌握情况智能推送复习内容，以便在轻松的氛围中高效记忆党史知识。

#### 验收标准

1. THE 小程序系统 SHALL 提供"星火燎原"卡片学习页面，屏幕中央展示精美的"红色记忆卡"
2. THE 小程序系统 SHALL 为每张卡片设计正反两面，正面展示历史照片或文物图片，背面展示核心知识点
3. THE 小程序系统 SHALL 使用movable-view组件实现卡片滑动交互，支持左滑、右滑和点击三种操作
4. WHEN 用户左滑卡片时，THE 小程序系统 SHALL 将该卡片标记为"模糊/不认识"并归入"待复习库"
5. WHEN 用户右滑卡片时，THE 小程序系统 SHALL 将该卡片标记为"已掌握"，卡片飞出屏幕并增加用户积分
6. WHEN 用户点击卡片时，THE 小程序系统 SHALL 翻转卡片，展示详细的历史背景
7. THE 小程序系统 SHALL 实现基于艾宾浩斯遗忘曲线的智能复习算法，在5分钟、1小时、1天后自动重新推送"待复习库"中的卡片
8. THE 小程序系统 SHALL 使用CSS动画实现卡片的飞出和回弹效果
9. THE 小程序系统 SHALL 提供至少50张红色记忆卡，涵盖重要历史事件、英雄人物和红色地标
10. THE 小程序系统 SHALL 在个人中心展示用户的学习进度，包括已掌握卡片数量、待复习卡片数量和学习天数
11. THE 小程序系统 SHALL 在卡片背面提供"AI详解"按钮，点击后调用讯飞星火API生成该知识点的详细讲解

---

### 需求 6：学习打卡与成就系统

**用户故事**：作为一名学生，我希望能够每天打卡记录学习，并获得成就徽章，以便养成持续学习的习惯并获得成就感。

#### 验收标准

1. THE 小程序系统 SHALL 在首页提供学习打卡按钮
2. WHEN 用户当天首次点击打卡按钮，THE 小程序系统 SHALL 记录打卡并显示打卡成功动画
3. WHEN 用户当天已打卡后再次点击，THE 小程序系统 SHALL 显示"今日已打卡"提示
4. THE 小程序系统 SHALL 在个人中心展示用户的连续打卡天数和总打卡天数
5. WHEN 用户连续打卡达到7天、30天等里程碑，THE 小程序系统 SHALL 弹出成就徽章获得提示
6. THE 小程序系统 SHALL 提供成就系统，包括"初识星火"（首次登录）、"好学之星"（连续打卡7天）、"党史达人"（掌握50张卡片）、"博学多才"（AI问答100次）等徽章
7. THE 小程序系统 SHALL 在个人中心展示用户已获得的徽章和未获得的徽章（灰色显示）

---

## 非功能性需求

### 性能需求

1. THE 小程序系统 SHALL 在2秒内完成首页加载
2. THE 云端服务 SHALL 在5秒内返回AI问答响应
3. THE 小程序系统 SHALL 在知识图谱页面实现流畅的交互体验（无明显卡顿）
4. THE 小程序系统 SHALL 支持至少100名用户同时在线使用

### 安全需求

1. THE 云端服务 SHALL 使用HTTPS协议加密所有数据传输
2. THE 云端服务 SHALL 使用HMAC-SHA256算法对讯飞星火API Key进行签名加密
3. THE 云端服务 SHALL 在BFF层实施敏感词过滤，确保意识形态安全
4. THE 云端服务 SHALL 实施API访问频率限制，防止恶意攻击

### 兼容性需求

1. THE 小程序系统 SHALL 兼容微信版本7.0及以上
2. THE 小程序系统 SHALL 适配iOS和Android操作系统
3. THE 小程序系统 SHALL 适配不同屏幕尺寸的移动设备

### 可维护性需求

1. THE 云端服务 SHALL 采用Serverless架构，基于微信云开发或云托管部署
2. THE 小程序系统 SHALL 使用模块化架构，将AI对话、知识图谱、卡片学习等功能解耦
3. THE 云端服务 SHALL 提供日志记录功能，便于调试和错误追踪

### 成本控制需求

1. THE 云端服务 SHALL 限制对话历史为最近10轮，控制讯飞星火API的Token消耗
2. THE 云端服务 SHALL 对知识图谱数据进行压缩，减少网络传输成本
3. THE 小程序系统 SHALL 对图片资源进行压缩和懒加载，优化加载速度

---

## 开发优先级

### P0（核心功能，必须完成）
- 需求1：用户认证与个人中心
- 需求2：AI虚拟讲解员系统
- 需求2.1：Function Call零幻觉知识检索
- 需求3：知识图谱可视化系统
- 需求5：Tinder式卡片学习

### P1（重要功能，尽量完成）
- 需求4：英雄长廊
- 需求6：学习打卡与成就系统

---

## 技术实现简化说明

为确保一周内完成，以下技术实现采用简化方案：

1. **AI对话**：不实现流式响应，直接等待完整回复；对话历史限制为10轮
2. **知识图谱**：使用AntV G6现成库，不自己写Canvas；节点数量控制在50个以内
3. **Function Call**：使用静态JSON文件作为知识库，不使用真实数据库
4. **卡片学习**：使用CSS动画代替复杂的物理引擎；艾宾浩斯算法简化为3个时间点
5. **数据准备**：使用AI生成模拟数据，不需要完整的党史数据库
6. **后端架构**：使用微信云开发，不需要自己搭建服务器

---

## 数据准备清单

为支持以上功能，需要准备以下数据（可使用AI生成）：

1. **英雄人物数据**：30位英雄的姓名、头像、简介、生平事迹（JSON格式）
2. **历史事件数据**：50个重要事件的时间、地点、人物、意义（JSON格式）
3. **知识图谱数据**：50个节点+100条边的图结构数据（JSON格式）
4. **记忆卡片数据**：50张卡片的正面图片、背面知识点（JSON格式）
5. **AI Prompt模板**：星火同志的System Prompt、各英雄人物的Persona Prompt
